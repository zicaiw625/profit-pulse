# Environment configuration

Profit Pulse validates a small set of core variables on startup and conditionally enables integrations when optional variables are present. Use this guide to understand what each value controls and when it is required.

## Core requirements

| Variable | Required | Description |
| --- | --- | --- |
| `SHOPIFY_API_KEY` | ✅ | Public app client ID used for OAuth and embedded app bridge. |
| `SHOPIFY_API_SECRET` | ✅ | App secret from the Shopify Partner Dashboard. Used for OAuth, webhook validation, and OAuth state fallback. |
| `SHOPIFY_APP_URL` | ✅ | Public HTTPS base URL that Shopify will call during auth, webhooks, and background jobs. |
| `SCOPES` | ✅ | Comma-separated list of Admin API scopes requested on install (e.g. `read_orders,read_products`). |
| `DATABASE_URL` | ✅ | Prisma connection string (PostgreSQL recommended). |
| `CREDENTIAL_ENCRYPTION_KEY` | ✅ | 32-byte secret used to encrypt third-party credentials at rest. |
| `OAUTH_STATE_SECRET` | ⚠️ | Optional override for OAuth state signing. Falls back to `SHOPIFY_API_SECRET` when omitted. |
| `SHOP_CUSTOM_DOMAIN` | ⚠️ | If set, restricts installs to a single custom shop domain. Useful for pilot rollouts. |

## Email & notifications

| Variable | Required | Description |
| --- | --- | --- |
| `PROFIT_PULSE_EMAIL_ENDPOINT` | ⚠️ | HTTPS endpoint that accepts POST requests for outbound email. Required to enable scheduled email reports. |

## Reporting & scheduling

| Variable | Required | Description |
| --- | --- | --- |
| `REPORT_SCHEDULE_CRON` | ⚠️ | Custom cron expression for report runner scripts. Defaults to the interval logic defined in `report-schedules-runner`. |

## Exchange rates

| Variable | Required | Description |
| --- | --- | --- |
| `EXCHANGE_RATE_API_URL` | ⚠️ | Optional override for the FX provider endpoint. Defaults to the bundled open API. |
| `EXCHANGE_RATE_API_KEY` | ⚠️ | API key for the configured FX provider. Required if the provider needs authentication. |

## Advertising integrations

| Variable | Required | Description |
| --- | --- | --- |
| `GOOGLE_ADS_CLIENT_ID` | ⚠️ | Google Ads OAuth client ID. Required to sync Google Ads spend. |
| `GOOGLE_ADS_CLIENT_SECRET` | ⚠️ | Google Ads OAuth client secret. |
| `GOOGLE_ADS_DEVELOPER_TOKEN` | ⚠️ | Developer token for Google Ads API access. |
| `META_ADS_APP_ID` | ⚠️ | Meta Ads application ID. |
| `META_ADS_APP_SECRET` | ⚠️ | Meta Ads application secret. |

## Payment provider integrations

| Variable | Required | Description |
| --- | --- | --- |
| `STRIPE_SECRET_KEY` | ⚠️ | Stripe secret key used to reconcile payouts. |
| `STRIPE_API_BASE_URL` | ⚠️ | Optional override for Stripe API base (defaults to `https://api.stripe.com/v1`). |
| `PAYPAL_CLIENT_ID` | ⚠️ | PayPal REST client ID for payout sync. |
| `PAYPAL_CLIENT_SECRET` | ⚠️ | PayPal REST client secret. |
| `PAYPAL_API_BASE_URL` | ⚠️ | Optional override for PayPal API base (defaults to `https://api-m.paypal.com`). |
| `KLARNA_USERNAME` | ⚠️ | Klarna API username for settlement reconciliation. |
| `KLARNA_PASSWORD` | ⚠️ | Klarna API password. |
| `KLARNA_API_BASE_URL` | ⚠️ | Optional override for Klarna API base (defaults to `https://api-na.klarna.com`). |

## ERP & accounting integrations

| Variable | Required | Description |
| --- | --- | --- |
| `ERP_COST_SYNC_URL` | ⚠️ | Endpoint for syncing ERP-sourced cost adjustments. |
| `QUICKBOOKS_SYNC_URL` | ⚠️ | Webhook or API endpoint for pushing accounting entries to QuickBooks. Enables QuickBooks toggle in settings. |
| `XERO_SYNC_URL` | ⚠️ | Endpoint for Xero accounting sync. Enables Xero toggle in settings. |

## Billing & monetization

| Variable | Required | Description |
| --- | --- | --- |
| `SHOPIFY_BILLING_TEST_MODE` | ⚠️ | When set to `true`, enables Shopify billing test mode to avoid live charges during development. |

## Seed & demo data

| Variable | Required | Description |
| --- | --- | --- |
| `SEED_SHOP_DOMAIN` | ⚠️ | Development convenience for the Prisma seed script. Defaults to `northwind-apparel.myshopify.com`. |
| `SEED_METRIC_DAYS` | ⚠️ | Number of daily metric rows generated by the seed script. Defaults to 30. |

## Operational tips

- Keep secrets (API keys, encryption key, OAuth secrets) out of version control. Use your hosting provider's secret manager.
- Review webhook allowlists whenever you onboard a new notification destination. Only domains enumerated in `notifications.server.js` will receive payloads.
- For multi-instance deployments, consider an external cache or message bus if you need to share memoized data across nodes; the default cache is process-local.
