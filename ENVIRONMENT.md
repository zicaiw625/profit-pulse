# Environment configuration

Profit Pulse validates a small set of core variables on startup and conditionally enables integrations when optional variables are present. Use this guide to understand what each value controls and when it is required.

## Core requirements

| Variable | Required | Description |
| --- | --- | --- |
| `SHOPIFY_API_KEY` | ✅ | Public app client ID used for OAuth and embedded app bridge. |
| `SHOPIFY_API_SECRET` | ✅ | App secret from the Shopify Partner Dashboard. Used for OAuth, webhook validation, and OAuth state fallback. |
| `SHOPIFY_APP_URL` | ✅ | Public HTTPS base URL that Shopify will call during auth, webhooks, and background jobs. |
| `SCOPES` | ✅ | Comma-separated list of Admin API scopes requested on install (e.g. `read_orders,read_products`). |
| `DATABASE_URL` | ✅ | Prisma connection string (PostgreSQL recommended). |
| `CREDENTIAL_ENCRYPTION_KEY` | ✅ | 32-byte secret used to encrypt third-party credentials at rest. |
| `OAUTH_STATE_SECRET` | ⚠️ | Optional override for OAuth state signing. Falls back to `SHOPIFY_API_SECRET` when omitted. |
| `SHOP_CUSTOM_DOMAIN` | ⚠️ | If set, restricts installs to a single custom shop domain. Useful for pilot rollouts. |

## Background sync tuning

| Variable | Required | Description |
| --- | --- | --- |
| `ORDER_SYNC_CONCURRENCY` | ⚠️ | Maximum number of Shopify orders processed in parallel during backfills. Defaults to 5. |
| `CREDENTIAL_REFRESH_CONCURRENCY` | ⚠️ | Upper bound on parallel ad credential refreshes. Defaults to 5. |
| `PAYOUT_SYNC_CONCURRENCY` | ⚠️ | Caps the number of simultaneous payout upserts when syncing PayPal settlements. Defaults to 5 with a hard ceiling of 10. |

## Caching

| Variable | Required | Description |
| --- | --- | --- |
| `UPSTASH_REDIS_REST_URL` | ⚠️ | HTTPS base URL for an Upstash Redis REST instance. When paired with `UPSTASH_REDIS_REST_TOKEN`, memoized cache reads/writes are shared across all Profit Pulse instances. |
| `UPSTASH_REDIS_REST_TOKEN` | ⚠️ | Bearer token for the Upstash REST endpoint. Required when `UPSTASH_REDIS_REST_URL` is set. |

## Exchange rates

| Variable | Required | Description |
| --- | --- | --- |
| `EXCHANGE_RATE_API_URL` | ⚠️ | Optional override for the FX provider endpoint. Defaults to the bundled open API. |
| `EXCHANGE_RATE_API_KEY` | ⚠️ | API key for the configured FX provider. Required if the provider needs authentication. |

## Advertising integrations

| Variable | Required | Description |
| --- | --- | --- |
| `META_ADS_APP_ID` | ⚠️ | Meta Ads application ID. |
| `META_ADS_APP_SECRET` | ⚠️ | Meta Ads application secret used during token exchange. |

## Payment provider integrations

| Variable | Required | Description |
| --- | --- | --- |
| `PAYPAL_CLIENT_ID` | ⚠️ | PayPal REST client ID for payout sync. |
| `PAYPAL_CLIENT_SECRET` | ⚠️ | PayPal REST client secret. |
| `PAYPAL_API_BASE_URL` | ⚠️ | Optional override for PayPal API base (defaults to `https://api-m.paypal.com`). |

## Billing & monetization

| Variable | Required | Description |
| --- | --- | --- |
| `SHOPIFY_BILLING_TEST_MODE` | ⚠️ | When set to `true`, enables Shopify billing test mode to avoid live charges during development. |

## Seed & demo data

| Variable | Required | Description |
| --- | --- | --- |
| `SEED_SHOP_DOMAIN` | ⚠️ | Development convenience for the Prisma seed script. Defaults to `northwind-apparel.myshopify.com`. |
| `SEED_METRIC_DAYS` | ⚠️ | Number of daily metric rows generated by the seed script. Defaults to 30. |

## Operational tips

- Keep secrets (API keys, encryption key, OAuth secrets) out of version control. Use your hosting provider's secret manager.
- Keep Meta Ads and PayPal variables scoped to each environment; restarting the app refreshes tokens if credentials become invalid.
- For multi-instance deployments, set the Upstash variables above to share memoized data across nodes; when omitted, the cache remains process-local and functions safely fall back to recomputing.
